package com.revshop.ui;



import java.util.Scanner;
import com.revshop.dao.*;
import com.revshop.model.*;
import com.revshop.service.BuyerService;
import com.revshop.service.SellerService;

public class main
{

    public static void main(String[] args) {

        Scanner sc = new Scanner(System.in);
        UserDAO userDAO = new UserDAO();
        int choice;

        do {
            System.out.println("\n===== REVSHOP =====");
            System.out.println("1. Register");
            System.out.println("2. Login");
            System.out.println("3. Forgot Password");
            System.out.println("4. Exit");

            choice = sc.nextInt();
            sc.nextLine();

            switch (choice) {

                case 1:
                    User user = new User();
                    System.out.print("Name: ");
                    user.setName(sc.nextLine());
                    System.out.print("Email: ");
                    user.setEmail(sc.nextLine());
                    System.out.print("Password: ");
                    user.setPassword(sc.nextLine());
                    System.out.print("Role (BUYER/SELLER): ");
                    user.setRole(sc.nextLine());

                    if (user.getRole().equalsIgnoreCase("SELLER")) {
                        System.out.print("Business Name: ");
                        user.setBusinessName(sc.nextLine());
                    }

                    System.out.print("Security Question: ");
                    user.setQuestion(sc.nextLine());
                    System.out.print("Answer: ");
                    user.setAnswer(sc.nextLine());

                    if (userDAO.registerUser(user))
                        System.out.println("Registration successful");
                    else
                        System.out.println("Registration failed");
                    break;

                case 2:
                    System.out.print("Email: ");
                    String email = sc.nextLine();
                    System.out.print("Password: ");
                    String pwd = sc.nextLine();

                    User loggedUser = userDAO.login(email, pwd);
                    if (loggedUser != null) {
                        System.out.println("Welcome " + loggedUser.getName());
                        if (loggedUser.getRole().equalsIgnoreCase("BUYER")) {
                            new BuyerService().buyerMenu();
                        } else {
                            new SellerService().sellerMenu();
                        }
                    } else {
                        System.out.println("Invalid credentials");
                    }
                    break;

                case 3:
                    System.out.print("Email: ");
                    String em = sc.nextLine();
                    System.out.print("Answer: ");
                    String ans = sc.nextLine();
                    System.out.print("New Password: ");
                    String np = sc.nextLine();

                    if (userDAO.forgotPassword(em, ans, np))
                        System.out.println("Password updated");
                    else
                        System.out.println("Wrong details");
                    break;

                case 4:
                    System.out.println("Thank you for using RevShop");
                    break;
            }
        } while (choice != 4);
    }
}